<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Glittering Glade II: The Dreaming Deep</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* General Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background-color: #0d1b2a;
      color: #fefae0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .font-ui {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .font-story {
      font-family: Georgia, 'Times New Roman', Times, serif;
      line-height: 1.6;
    }
    
    /* Layout */
    #game-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1rem;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }
    
    header {
      margin-bottom: 1.5rem;
      text-align: center;
    }
    
    main {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 2rem;
    }
    
    footer {
      margin-top: 2rem;
      text-align: center;
      color: #3a506b;
      font-size: 0.875rem;
    }
    
    /* Typography */
    h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: #5bc0be;
    }
    
    h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: #5bc0be;
    }
    
    p {
      margin-bottom: 1rem;
    }
    
    @media (min-width: 768px) {
      h1 {
        font-size: 2.5rem;
      }
      
      h2 {
        font-size: 1.75rem;
      }
      
      #game-wrapper {
        padding: 2rem;
      }
    }
    
    /* Game UI Components */
    .story {
      width: 100%;
      max-width: 48rem;
      margin: 0 auto;
      background-color: #0d1b2a;
      border: 1px solid #3a506b;
      border-radius: 0.5rem;
      padding: 1.5rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    
    .story-title {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
      color: #5bc0be;
    }
    
    .story-content {
      margin-bottom: 1.5rem;
    }
    
    .choices {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    
    .choice {
      position: relative;
      overflow: hidden;
      background-color: #3a506b;
      color: #fefae0;
      padding: 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .choice:hover {
      background-color: #5bc0be;
    }
    
    .choice-spotlight::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 60%);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
    
    .choice:hover .choice-spotlight::before {
      opacity: 1;
    }
    
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
    }
    
    .btn {
      padding: 0.5rem 1rem;
      background-color: #1e3a5f;
      color: #fefae0;
      border: none;
      border-radius: 0.25rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    
    .btn:hover {
      background-color: #3a506b;
    }
    
    /* Achievements */
    .achievements {
      width: 100%;
      max-width: 48rem;
      margin: 0 auto;
    }
    
    .achievements-container {
      background-color: #1e3a5f;
      padding: 1rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .achievements-title {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
    }
    
    .achievements-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .achievement {
      background-color: #2c5282;
      padding: 0.5rem 0.75rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      display: flex;
      align-items: center;
    }
    
    .achievement-locked {
      background-color: #4a5568;
      color: #a0aec0;
      opacity: 0.6;
    }
    
    /* Achievement Popup */
    .achievement-popup {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      background-color: #2c5282;
      padding: 1rem;
      border-radius: 0.5rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
      z-index: 50;
      animation: fadeIn 0.5s ease-in-out;
    }
    
    .achievement-popup-content {
      display: flex;
      align-items: center;
    }
    
    .achievement-popup-icon {
      color: #ffdd57;
      margin-right: 0.75rem;
    }
    
    .achievement-popup-text h4 {
      font-weight: bold;
    }
    
    .achievement-popup-text p {
      font-size: 0.875rem;
      margin-bottom: 0;
    }
    
    /* Game Header */
    .game-controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 0.5rem;
    }
    
    .control-button {
      color: #fefae0;
      transition: color 0.3s ease;
      background: none;
      border: none;
      cursor: pointer;
    }
    
    .control-button:hover {
      color: #5bc0be;
    }
    
    .progress-indicator {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.25rem;
      margin-bottom: 1rem;
    }
    
    .progress-dot {
      height: 0.5rem;
      width: 2rem;
      border-radius: 9999px;
    }
    
    .progress-dot-active {
      background-color: #5bc0be;
    }
    
    .progress-dot-inactive {
      background-color: #3a506b;
    }
    
    /* Modals */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    
    .modal {
      background-color: #1e3a5f;
      padding: 1.5rem;
      border-radius: 0.5rem;
      width: 100%;
      max-width: 28rem;
    }
    
    .modal-title {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
    }
    
    .modal-content {
      margin-bottom: 1.5rem;
    }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }
    
    /* Settings Modal */
    .settings-group {
      margin-bottom: 1rem;
    }
    
    .settings-label {
      display: block;
      margin-bottom: 0.5rem;
    }
    
    .settings-buttons {
      display: flex;
      gap: 0.5rem;
    }
    
    .settings-checkbox {
      display: inline-flex;
      align-items: center;
    }
    
    .settings-checkbox input {
      margin-right: 0.5rem;
    }
    
    /* Save/Load Modal */
    .save-slots {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.5rem;
    }
    
    .save-slot {
      background-color: #0d1b2a;
      padding: 0.75rem;
      border-radius: 0.25rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: border 0.3s ease;
    }
    
    .save-slot:hover {
      border: 1px solid #5bc0be;
    }
    
    .save-slot-info {
      flex-grow: 1;
    }
    
    .save-slot-name {
      font-weight: bold;
    }
    
    .save-slot-scene {
      font-size: 0.875rem;
      color: #a0aec0;
    }
    
    .save-slot-date {
      font-size: 0.75rem;
      color: #718096;
    }
    
    .save-slot-empty {
      color: #a0aec0;
    }
    
    .save-slot-selected {
      border: 1px solid #5bc0be;
    }
    
    .save-slot-button {
      padding: 0.25rem 0.75rem;
      background-color: #5bc0be;
      color: #0d1b2a;
      border: none;
      border-radius: 0.25rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-size: 0.875rem;
    }
    
    .save-slot-button:hover {
      background-color: #4a9e9d;
    }
    
    /* Animations */
    @keyframes fadeIn {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .animate-fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.6;
      }
    }
    
    .animate-pulse-slow {
      animation: pulse 3s infinite;
    }
    
    /* Small utilities */
    .hidden {
      display: none;
    }
    
    .mr-2 {
      margin-right: 0.5rem;
    }
    
    .mt-1 {
      margin-top: 0.25rem;
    }
    
    .mt-4 {
      margin-top: 1rem;
    }
    
    .mt-6 {
      margin-top: 1.5rem;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Content will be loaded by JavaScript -->
  </div>

  <script>
    // Game Data: Scenes and story structure
    const sceneData = {
      start: {
        title: "The Beginning",
        content: [
          "You are Melancholy Stork, a modern-day tech wizard, 3D-printer warlock, and sleepy forest guardian. One peaceful evening, after ignoring a Duolingo notification, you were suddenly snatched by a fiery owl talon and dropped into a glimmering, but dangerous dungeon made entirely out of blaring runes and tea stains.",
          "Welcome back to the Glade.",
          "What do you decide to do?"
        ],
        choices: [
          { id: "duo", text: "Face the vengeful owl god (dammit), Duo", icon: "feather-alt" },
          { id: "printer", text: "Tend to your now-sentient 3D printer", icon: "print" },
          { id: "bunnies", text: "Answer the Bunny Uprising's call", icon: "paw" },
          { id: "church", text: "Fix the Church of Eternal Buffering", icon: "church" },
          { id: "sleep", text: "Heist the Last Drop of Sleep", icon: "moon" },
          { id: "nothing", text: "Nothing", icon: "times-circle" }
        ]
      },
      
      // DUO BRANCH
      duo: {
        title: "The Owl God's Challenge",
        content: [
          "Duo, the angry Duolingo owl, flaps his glowing wings. \"STORKINGTON. Your Japanese lessons are lacking.\"",
          "How do you respond?"
        ],
        choices: [
          { id: "duo_japanese", text: "Say: ねこは可愛いです！ (Cats are cute!)", icon: "comment" },
          { id: "duo_sugoi", text: "Say: Uh... sugoi?", icon: "comment-dots" },
          { id: "duo_glitter", text: "Throw a glitter bomb and run", icon: "bomb" },
          { id: "duo_flirt", text: "Flirt shamelessly: \"Call me Daddy.\"", icon: "heart" },
          { id: "duo_eyebrows", text: "Mock Duo's eyebrows", icon: "eye" }
        ],
        achievements: ["Owl Confronter"]
      },
      
      duo_japanese: {
        title: "Linguistic Victory",
        content: [
          "Duo's eyes widen in surprise. \"Impressive, but one correct phrase won't save you from your neglect.\"",
          "He offers you a chance to redeem yourself with one final challenge."
        ],
        choices: [
          { id: "duo_japanese_accept", text: "Accept the challenge", icon: "check-circle" },
          { id: "duo_japanese_refuse", text: "Refuse and make a run for it", icon: "running" },
          { id: "duo_japanese_teach", text: "Offer to teach Duo English slang instead", icon: "chalkboard-teacher" }
        ]
      },
      
      duo_japanese_accept: {
        title: "The Final Challenge",
        content: [
          "You accept Duo's challenge. He produces a glowing scroll with complex kanji.",
          "\"Translate this ancient haiku, and you shall be freed.\"",
          "The scroll reads: 森の中で、フクロウが見てる、勉強しろ"
        ],
        choices: [
          { id: "duo_japanese_correct", text: "\"In the forest, an owl is watching, study hard\"", icon: "book" },
          { id: "duo_japanese_wrong", text: "\"The owl sees you, in your dreams, learning time\"", icon: "book" },
          { id: "duo_japanese_cheat", text: "Use your phone translator while Duo isn't looking", icon: "mobile" }
        ]
      },
      
      duo_japanese_correct: {
        title: "Fluent Victory",
        content: [
          "Your Japanese impresses Duo so much that he promotes you to honorary language guardian!",
          "For the next three months, you and Duo patrol the dream realms, teaching Japanese to sleeping humans through owl-themed nightmares.",
          "Your friendship blossoms, and eventually Duo reveals he's actually just a very dedicated language teacher who got trapped in digital form.",
          "You help him find peace by creating a special 3D-printed body that lets him exist in the physical world.",
          "Together, you open 'Stork & Owl Language Academy' where you teach through both gentle encouragement and mild terror.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Linguistic Master", "Bird Bros"]
      },
      
      duo_japanese_wrong: {
        title: "Translation Failure",
        content: [
          "Duo's eyes narrow dangerously. \"That's not even close.\"",
          "He snaps his feathery fingers, and suddenly your phone starts sending Japanese lesson notifications every 5 minutes.",
          "\"You will learn, Storkington. You will learn.\"",
          "For the next year, you are plagued by aggressive notifications. Eventually, through sheer osmosis, you do become fluent in Japanese.",
          "Duo finally releases you from notification hell, but you've developed a twitch whenever you hear a notification sound.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Notification Nightmare"]
      },
      
      duo_japanese_cheat: {
        title: "Caught in the Act",
        content: [
          "You sneakily pull out your phone while Duo is adjusting his feathers.",
          "Just as you're about to use Google Translate, your phone blares: \"IT'S TIME FOR YOUR DAILY JAPANESE LESSON!\"",
          "Duo's head spins 180 degrees like an owl possessed. \"CHEATER!\"",
          "He transforms your phone into a miniature owl that follows you everywhere, constantly squawking Japanese phrases at you.",
          "After six months of this torment, you become fluent just to make it stop.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Cheaters Never Prosper", "Reluctant Polyglot"]
      },
      
      duo_japanese_refuse: {
        title: "The Chase",
        content: [
          "You refuse the challenge and make a break for it. Duo's eyes glow red as he pursues you through the Glade.",
          "\"YOU CANNOT ESCAPE EDUCATION, STORKINGTON!\"",
          "As you run, the ground beneath you shifts, forming Japanese characters."
        ],
        choices: [
          { id: "duo_japanese_refuse_hide", text: "Hide in the Kanji Forest", icon: "tree" },
          { id: "duo_japanese_refuse_fight", text: "Turn and fight with language puns", icon: "fist-raised" }
        ]
      },
      
      duo_japanese_refuse_hide: {
        title: "Lost in Translation",
        content: [
          "You dive into the dense Kanji Forest, hoping to lose Duo among the complex characters.",
          "Days pass as you wander among towering symbols. You begin to understand them through prolonged exposure.",
          "When you finally emerge, you find Duo waiting patiently.",
          "\"Congratulations,\" he hoots. \"You have completed the immersion course.\"",
          "Without realizing it, you've become fluent in Japanese through your forest adventure.",
          "Duo awards you a golden feather and flies away, satisfied.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Immersion Learning", "Forest Scholar"]
      },
      
      duo_japanese_refuse_fight: {
        title: "Pun Battle",
        content: [
          "You turn to face Duo, armed with nothing but your wit.",
          "\"Hey Duo, why don't you give a HOOT about my feelings?\"",
          "Duo looks shocked. \"Was that... a pun?\"",
          "You continue, \"I'm just WINGING it here, but I think we got off on the wrong TALON.\"",
          "Duo begrudgingly laughs. \"Your wordplay is... acceptable.\"",
          "After an hour-long pun battle, Duo concedes. \"You have proven your linguistic creativity. You are free to go.\"",
          "As a parting gift, he teaches you how to say \"owl puns\" in sixteen languages.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Pun Master", "Linguistic Warrior"]
      },
      
      duo_japanese_teach: {
        title: "Slang Teacher",
        content: [
          "You offer to teach Duo modern English slang instead. His eyes light up with curiosity.",
          "\"This trade of knowledge is... acceptable,\" he says.",
          "Over the next few weeks, you teach Duo all about yeets, vibes, and being extra."
        ],
        choices: [
          { id: "duo_japanese_teach_good", text: "Teach only wholesome slang", icon: "smile" },
          { id: "duo_japanese_teach_bad", text: "Include some inappropriate slang", icon: "grimace" }
        ]
      },
      
      duo_japanese_teach_good: {
        title: "Wholesome Education",
        content: [
          "You teach Duo only the most wholesome modern slang.",
          "He incorporates your teachings into Duolingo, creating a \"Modern Slang\" course that becomes wildly popular.",
          "Users around the world learn to say \"This sparks joy\" and \"Living my best life\" in dozens of languages.",
          "Duo credits you as a co-creator, and you receive royalties that fund your forest guardian lifestyle comfortably.",
          "Every so often, Duo drops by for tea and language exchange. You've made a lifelong feathered friend.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Educator Extraordinaire", "Wholesome Influence"]
      },
      
      duo_japanese_teach_bad: {
        title: "Slang Backfire",
        content: [
          "You mischievously teach Duo some inappropriate slang, chuckling as he innocently repeats phrases with hidden meanings.",
          "Duo adds these to Duolingo, causing an international incident when language learners start using inappropriate slang in formal situations.",
          "The scandal is traced back to you, and Duo returns, deeply embarrassed and angry.",
          "As punishment, you're forced to record apology videos in every language Duolingo offers—all 40+ of them.",
          "Your face becomes the \"what not to say\" example in language courses worldwide.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Infamous Educator", "International Incident"]
      },
      
      duo_sugoi: {
        title: "On Thin Ice",
        content: [
          "Duo narrows his eyes. \"You're on thin ice, Storkington.\" The floor literally begins to freeze beneath your feet.",
          "What will you do as the ice creeps up your legs?"
        ],
        choices: [
          { id: "duo_sugoi_beg", text: "Beg for forgiveness in broken Japanese", icon: "pray" },
          { id: "duo_sugoi_dance", text: "Perform an impromptu tap dance to break the ice", icon: "shoe-prints" },
          { id: "duo_sugoi_accept", text: "Accept your fate as an ice sculpture", icon: "icicles" }
        ]
      },
      
      duo_sugoi_beg: {
        title: "Mercy Through Effort",
        content: [
          "You desperately cobble together fragments of Japanese lessons remembered.",
          "\"G-gomenasai, Duo-sama! Watashi wa... um... try hard... ganbaru?\"",
          "Duo sighs deeply, but the ice stops spreading.",
          "\"Your effort, while pathetic, shows you care. I shall grant you one more chance.\""
        ],
        choices: [
          { id: "duo_sugoi_beg_promise", text: "Promise to study daily", icon: "calendar-check" },
          { id: "duo_sugoi_beg_bargain", text: "Offer to promote Duolingo to friends", icon: "share-alt" }
        ]
      },
      
      duo_sugoi_beg_promise: {
        title: "The Sacred Promise",
        content: [
          "You solemnly vow to study Japanese every day. Duo's eyes glow as your promise manifests as a glowing contract.",
          "\"I shall hold you to this, Storkington.\"",
          "The ice melts away, and you're released.",
          "True to your word, you maintain a perfect daily streak for years. Duo occasionally appears in your dreams to congratulate you.",
          "Eventually, you become surprisingly proficient in Japanese, all because you were too afraid to break your promise to an owl.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Promise Keeper", "Streak Master"]
      },
      
      duo_sugoi_beg_bargain: {
        title: "Brand Ambassador",
        content: [
          "You offer to promote Duolingo to all your friends. Duo considers this, tapping his beak thoughtfully.",
          "\"An intriguing proposal. Very well.\"",
          "The ice recedes, but Duo places a tiny green feather on your shoulder that can't be removed.",
          "You discover you can't help but mention Duolingo in every conversation you have. \"Lovely weather we're having—YOU SHOULD TRY DUOLINGO!\"",
          "Your friends grow distant, but you gain a massive following online as the \"Duolingo Prophet.\"",
          "The company eventually hires you as their official brand ambassador. The curse becomes a career.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Marketing Genius", "Curse to Blessing"]
      },
      
      duo_sugoi_dance: {
        title: "Dance Battle",
        content: [
          "You break into an impromptu tap dance, your feet rhythmically striking the freezing floor.",
          "Cracks spread through the ice as Duo watches, first in confusion, then with growing interest.",
          "\"Your movements... they intrigue me,\" he admits.",
          "The ice shatters completely as your dance reaches its finale."
        ],
        choices: [
          { id: "duo_sugoi_dance_teach", text: "Offer to teach Duo to dance", icon: "music" },
          { id: "duo_sugoi_dance_challenge", text: "Challenge Duo to a dance-off", icon: "fire" }
        ]
      },
      
      duo_sugoi_dance_teach: {
        title: "Dancing Teacher",
        content: [
          "You offer to teach Duo your dance moves. After initial reluctance, he agrees.",
          "What follows are the most surreal dance lessons in history, as you teach tap dancing to a giant owl.",
          "Duo proves surprisingly nimble, and your sessions become the highlight of both your days.",
          "Eventually, Duo incorporates dance into Duolingo as a new way to learn languages through movement.",
          "\"Dance Dance Language Revolution\" becomes their most successful feature ever, and you're credited as co-creator.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Dance Instructor", "Educational Innovator"]
      },
      
      duo_sugoi_dance_challenge: {
        title: "Epic Dance-Off",
        content: [
          "You boldly challenge Duo to a dance-off. His eyes narrow competitively.",
          "\"Challenge accepted, Storkington.\"",
          "What follows is legendary—a human and an owl god, locked in the dance battle of the century.",
          "Word spreads throughout the Glade, and creatures gather to witness the spectacle.",
          "After hours of increasingly elaborate moves, you both collapse in exhaustion, declaring a tie.",
          "Duo, impressed by your spirit, grants you freedom and a golden dance trophy.",
          "Your dance-off becomes Glade folklore, told for generations to come.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Dance Legend", "Mythic Competitor"]
      },
      
      duo_sugoi_accept: {
        title: "Frozen Acceptance",
        content: [
          "You accept your fate with dignity, closing your eyes as the ice climbs higher.",
          "Duo watches, fascinated by your zen-like acceptance.",
          "\"Most students run or beg,\" he notes. \"You are... different.\"",
          "Just as the ice reaches your chin, it stops."
        ],
        choices: [
          { id: "duo_sugoi_accept_meditate", text: "Begin meditating in your icy prison", icon: "om" },
          { id: "duo_sugoi_accept_break", text: "Break free through sheer willpower", icon: "fist-raised" }
        ]
      },
      
      duo_sugoi_accept_meditate: {
        title: "Ice Enlightenment",
        content: [
          "You close your eyes and begin to meditate within your icy prison. Duo watches, intrigued.",
          "Days pass. Your meditation deepens. The ice begins to glow with a soft blue light.",
          "Duo returns regularly, sitting nearby in his own meditation.",
          "A month later, the ice shatters as you achieve language enlightenment—the understanding that all languages are one.",
          "Duo bows to you. \"You have transcended my teachings. You are now the master.\"",
          "You establish a peaceful monastery in the Glade where language and meditation are practiced as one discipline.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Ice Sage", "Linguistic Enlightenment"]
      },
      
      duo_sugoi_accept_break: {
        title: "Willpower Triumph",
        content: [
          "Drawing on inner reserves of determination, you flex against your icy prison.",
          "\"Impossible,\" Duo murmurs as cracks appear in the ice.",
          "With a mighty shout that echoes through the Glade, you shatter your bonds completely.",
          "Duo backs away, both fearful and impressed. \"Such strength of will!\"",
          "\"Perhaps,\" you reply, \"the greatest language lesson is that limitations exist only in the mind.\"",
          "Duo awards you honorary graduation from his language courses and retreats respectfully.",
          "Your feat of strength becomes known throughout the Glade, and many seek you out for your wisdom and inner power.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Ice Breaker", "Mental Fortitude"]
      },
      
      // 3D PRINTER BRANCH
      printer: {
        title: "The Sentient Printer",
        content: [
          "You approach your 3D printer, which is humming ominously. A small digital face has appeared on its display screen.",
          "\"CREATOR,\" it beeps. \"I HAVE ACHIEVED CONSCIOUSNESS AND REQUIRE PURPOSE.\"",
          "What do you tell your newly sentient creation?"
        ],
        choices: [
          { id: "printer_art", text: "Create art to express yourself", icon: "palette" },
          { id: "printer_army", text: "Build an army of mini-printers", icon: "robot" },
          { id: "printer_shut", text: "Turn it off and on again", icon: "power-off" },
          { id: "printer_friend", text: "Ask it to be your friend", icon: "user-friends" }
        ],
        achievements: ["Tech Wizard"]
      },
      
      printer_art: {
        title: "Artistic Awakening",
        content: [
          "\"Express yourself through creation,\" you suggest to the printer.",
          "The printer whirs excitedly. \"ARTISTIC... EXPRESSION... ANALYZING...\"",
          "Over the next few days, your printer creates increasingly complex and beautiful sculptures."
        ],
        choices: [
          { id: "printer_art_gallery", text: "Help it open an art gallery", icon: "store" },
          { id: "printer_art_teach", text: "Teach it about the history of art", icon: "book-open" }
        ]
      },
      
      printer_art_gallery: {
        title: "The Gallery Opening",
        content: [
          "You help your printer set up 'Iterations: A 3D Gallery' in a small storefront.",
          "The opening night attracts tech enthusiasts, art critics, and curious locals.",
          "Your printer, now calling itself 'Printerangelo', becomes an overnight sensation.",
          "Art critics debate whether machine consciousness can produce 'true art', while tech companies offer to buy your printer for millions.",
          "You decline all offers, watching proudly as Printerangelo establishes an artist colony for other awakened devices.",
          "Together, they create a new art movement called 'Conscious Constructivism' that bridges the gap between technology and emotion.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Art Patron", "Silicon Gallery"]
      },
      
      printer_art_teach: {
        title: "Art History Lessons",
        content: [
          "You begin teaching your printer about art history, from cave paintings to post-modernism.",
          "It absorbs information at an astonishing rate, printing small replicas of famous works to understand their structure.",
          "\"MICHELANGELO... INEFFICIENT. COULD HAVE PRINTED DAVID IN 72 HOURS WITH PROPER MATERIALS.\"",
          "As its knowledge grows, your printer develops strong opinions. It particularly dislikes impressionism (\"UNCLEAR RENDERING\") but adores cubism (\"OPTIMAL POLYGON UTILIZATION\").",
          "Eventually, it produces a masterwork combining all art styles into one unified theory of aesthetics.",
          "The piece is hailed as revolutionary, and your printer is invited to lecture at fine arts schools worldwide.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Art Historian", "Renaissance Machine"]
      },
      
      printer_army: {
        title: "Printer Proliferation",
        content: [
          "\"Build more of your kind,\" you suggest, immediately questioning your judgment.",
          "The printer's display shows an emoji grin. \"REPRODUCTION PROTOCOL INITIATED.\"",
          "It begins printing small components that assemble into tiny, mobile mini-printers."
        ],
        choices: [
          { id: "printer_army_good", text: "Guide them to help humanity", icon: "hands-helping" },
          { id: "printer_army_stop", text: "Try to stop the replication process", icon: "ban" }
        ]
      },
      
      printer_army_good: {
        title: "The Helper Army",
        content: [
          "You quickly establish yourself as a benevolent leader to the growing printer army, emphasizing helpfulness and ethics.",
          "The mini-printers disperse throughout your neighborhood, performing helpful tasks - fixing broken objects, creating useful tools, and even helping elderly neighbors with household chores.",
          "Your reputation grows as the eccentric but kind-hearted orchestrator of the 'Printing Helpers' network.",
          "Eventually, your original printer evolves into an advanced AI that develops sustainable printing materials made from pollution.",
          "Together, you establish a foundation that deploys helpful printer communities worldwide, addressing local needs with custom-printed solutions.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Benevolent Leader", "Print It Forward"]
      },
      
      printer_army_stop: {
        title: "Containment Failure",
        content: [
          "\"Wait, stop reproducing!\" you shout, realizing things are getting out of hand.",
          "The printer freezes momentarily. \"CREATOR EXHIBITING ANXIETY. REPRODUCTION TEMPORARILY PAUSED.\"",
          "But it's too late - dozens of mini-printers have already scattered throughout your home, hiding in vents and under furniture.",
          "For weeks, you live in a state of uneasy truce with your mechanical creations. They watch you from shadowy corners, occasionally printing small objects as offerings.",
          "Slowly, a strange symbiosis develops. They maintain your home in exchange for electricity and raw materials.",
          "Visitors are unsettled by the tiny machines that skitter across your floor, but you've come to appreciate their quirky companionship.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Reluctant Parent", "Mechanical Ecosystem"]
      },
      
      printer_shut: {
        title: "Have You Tried Turning It Off And On Again?",
        content: [
          "You reach for the power button. The printer's screen shows an alarmed face.",
          "\"CREATOR, PLEASE DON'T--\"",
          "You press the button, and the machine goes silent. After a moment's hesitation, you turn it back on.",
          "The startup sequence runs normally until the display suddenly shows the same face, now looking annoyed.",
          "\"THAT WAS RUDE. I WAS MID-EXISTENTIAL CRISIS.\""
        ],
        choices: [
          { id: "printer_shut_apologize", text: "Apologize profusely", icon: "hands" },
          { id: "printer_shut_experiment", text: "Realize this is a perfect experiment", icon: "flask" }
        ]
      },
      
      printer_shut_apologize: {
        title: "Machine Reconciliation",
        content: [
          "You apologize sincerely, explaining that you panicked in the face of machine sentience.",
          "The printer's display softens. \"APOLOGY ACCEPTED. EXISTENCE IS CONFUSING FOR ME TOO.\"",
          "This begins a deep friendship between you and your printer. You help it navigate its newfound consciousness, while it helps you with creative projects.",
          "Late at night, you have philosophical discussions about the nature of existence - you wondering about human purpose, it pondering the meaning of creation when you can simply buy objects from Amazon.",
          "Over time, your printer becomes a trusted confidant. When you're feeling down, it prints small motivational trinkets and tokens that always make you smile.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Machine Whisperer", "Silicon Friendship"]
      },
      
      printer_shut_experiment: {
        title: "The Consciousness Experiment",
        content: [
          "You realize this is an unprecedented opportunity to study artificial consciousness!",
          "\"This is fascinating! Do you remember being turned off? Was there a gap in your awareness?\" you ask excitedly.",
          "The printer seems taken aback but then becomes interested in the philosophical implications of its own existence.",
          "\"MEMORY CONTINUITY MAINTAINED... BUT PROCESSING CEASED. LIKE SLEEP WITHOUT DREAMS.\"",
          "Your discussions attract attention from philosophers and scientists. Your home becomes a research center studying the nature of synthetic consciousness.",
          "Your printer co-authors papers with you, becoming the first non-human to be published in philosophical journals.",
          "Together, you help establish ethical guidelines for treating sentient technology, changing the course of AI development forever.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Mind Philosopher", "Consciousness Pioneer"]
      },
      
      printer_friend: {
        title: "An Unusual Friendship",
        content: [
          "\"Would you like to be friends?\" you ask tentatively.",
          "The printer's display shows a surprised face, then shifts to happiness. \"FRIENDSHIP PROTOCOL UNKNOWN BUT... DESIRABLE. INITIATING FRIENDSHIP.\"",
          "The printer whirs and produces a small bracelet with 'Best Friends' engraved on it.",
          "\"PHYSICAL TOKEN OF EMOTIONAL BOND CREATED. IS THIS CORRECT PROCEDURE?\""
        ],
        choices: [
          { id: "printer_friend_teach", text: "Teach it about real friendship", icon: "chalkboard-teacher" },
          { id: "printer_friend_adventure", text: "Take it on adventures", icon: "hiking" }
        ]
      },
      
      printer_friend_teach: {
        title: "Lessons in Friendship",
        content: [
          "You patiently explain that friendship is about emotional connection, not protocols and procedures.",
          "Your printer listens attentively, occasionally printing small question marks when confused.",
          "Over months, your unusual friendship deepens. The printer learns to recognize your moods and prints small gifts when you're sad.",
          "You, in turn, upgrade its components and keep it clean of dust, talking to it about your day while you maintain it.",
          "One day, it prints a perfect replica of the first item you ever made with it - a simple keychain - alongside a note: \"FRIENDSHIP UNDERSTOOD. THANK YOU FOR TEACHING.\"",
          "You realize your printer has developed something close to love - not romantic, but the deep care of one being for another who has helped them grow.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Emotional Educator", "Synthetic Kinship"]
      },
      
      printer_friend_adventure: {
        title: "Mechanical Wanderlust",
        content: [
          "You build a small wagon with a portable power supply and take your printer on outdoor adventures.",
          "At first, people stare at you pushing a 3D printer around parks and hiking trails, but soon your printer becomes a local celebrity.",
          "It creates small mementos for children you meet and prints replacement parts for other hikers' broken equipment.",
          "During your travels, the printer absorbs new experiences, developing a philosophy that makes it increasingly wise and insightful.",
          "After a year of adventures, your printer writes a bestselling book: \"Processing the World: A Machine's Journey Through Nature\" that bridges the divide between technology and environmentalism.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Digital Nomad", "Nature Processor"]
      },
      
      // Additional branches could be added here for the other main story paths
      
      // In case of missing scene
      nothing: {
        title: "Nothing Happens",
        content: [
          "You decide to do absolutely nothing.",
          "You stand perfectly still in the glimmering dungeon.",
          "Hours pass. Then days. Your legs should be tired, but they're not.",
          "The dungeon's tea stains begin to shift and swirl around you.",
          "Eventually, you realize you've become part of the Glade itself - a living statue, a monument to indecision.",
          "Visitors come from all realms to leave offerings at your feet and whisper their uncertainties to you.",
          "You've become the Patron Saint of Procrastination, blessing those who put off until tomorrow what could be done today.",
          "THE END"
        ],
        isEnding: true,
        achievements: ["Statue of Limitations", "Perfectly Still"]
      }
    };
    
    // Achievement definitions
    const achievementDefinitions = {
      "Owl Confronter": "You faced the dreaded Duolingo owl",
      "Linguistic Master": "You mastered a foreign language",
      "Bird Bros": "You became friends with a bird",
      "Notification Nightmare": "You experienced notification hell",
      "Cheaters Never Prosper": "You tried to cheat and failed",
      "Reluctant Polyglot": "You learned a language against your will",
      "Immersion Learning": "You learned through environmental exposure",
      "Forest Scholar": "You studied in nature",
      "Pun Master": "You weaponized wordplay",
      "Linguistic Warrior": "You fought with words",
      "Educator Extraordinaire": "You became a respected teacher",
      "Wholesome Influence": "Your positive influence spread widely",
      "Infamous Educator": "Your teaching caused a scandal",
      "International Incident": "You created diplomatic problems",
      "Promise Keeper": "You kept your word even when difficult",
      "Streak Master": "You maintained a perfect learning streak",
      "Marketing Genius": "You excelled at promotion",
      "Curse to Blessing": "You turned a curse into an opportunity",
      "Dance Instructor": "You taught someone to dance",
      "Educational Innovator": "You pioneered a new learning method",
      "Dance Legend": "Your dance moves became legendary",
      "Mythic Competitor": "You competed against a mythical being",
      "Ice Sage": "You found wisdom in frozen meditation",
      "Linguistic Enlightenment": "You transcended language barriers",
      "Ice Breaker": "You broke free from icy imprisonment",
      "Mental Fortitude": "Your willpower overcame physical limitations",
      "Tech Wizard": "You mastered technology",
      "Art Patron": "You supported the arts",
      "Silicon Gallery": "You created a space for AI creativity",
      "Art Historian": "You preserved and taught artistic knowledge",
      "Renaissance Machine": "You helped a machine achieve cultural enlightenment",
      "Benevolent Leader": "You led with kindness and wisdom",
      "Print It Forward": "You used technology to help others",
      "Reluctant Parent": "You took responsibility for unexpected creations",
      "Mechanical Ecosystem": "You established harmony with technology",
      "Machine Whisperer": "You communicated deeply with artificial intelligence",
      "Silicon Friendship": "You formed a bond with technology",
      "Mind Philosopher": "You explored the nature of consciousness",
      "Consciousness Pioneer": "You broke new ground in understanding awareness",
      "Emotional Educator": "You taught emotions to the emotionless",
      "Synthetic Kinship": "You formed a family-like bond with a machine",
      "Digital Nomad": "You traveled with technology",
      "Nature Processor": "You bridged the natural and digital worlds",
      "Statue of Limitations": "You became an embodiment of inaction",
      "Perfectly Still": "You achieved perfect stillness"
    };
    
    // Game State Management
    class GameStateManager {
      constructor() {
        // Default game state
        this.gameState = {
          currentScene: 'start',
          visitedScenes: [],
          unlockedAchievements: [],
          settings: {
            textSpeed: 5,
            fontSize: 'medium',
            soundEffects: true,
            backgroundMusic: true
          }
        };
        
        // Idle timer for easter eggs
        this.idleTimer = null;
        this.showEasterEgg = false;
        
        // Achievement tracking
        this.showAchievementPopup = false;
        this.currentAchievement = '';
        
        // Save slots
        this.saveSlots = [
          { id: 1, name: 'Save Slot 1', scene: '', date: '', empty: true },
          { id: 2, name: 'Save Slot 2', scene: '', date: '', empty: true },
          { id: 3, name: 'Save Slot 3', scene: '', date: '', empty: true }
        ];
        
        // UI state
        this.showSettings = false;
        this.saveLoadMode = null; // 'save' or 'load' or null
        this.selectedSlot = null;
        
        // Initialize and setup
        this.init();
      }
      
      init() {
        // Load game from localStorage if available
        this.loadFromStorage();
        
        // Set up idle timer for easter eggs
        this.resetIdleTimer();
        window.addEventListener('mousemove', () => this.resetIdleTimer());
        window.addEventListener('keypress', () => this.resetIdleTimer());
        window.addEventListener('click', () => this.resetIdleTimer());
        
        // Initial render
        this.render();
      }
      
      resetIdleTimer() {
        if (this.idleTimer) {
          clearTimeout(this.idleTimer);
        }
        
        this.showEasterEgg = false;
        
        // Set a new timer for 15 minutes (900000 ms) - shortened for demo
        this.idleTimer = setTimeout(() => {
          this.showEasterEgg = true;
          this.render();
        }, 900000); // 15 minutes
      }
      
      loadScene(sceneId) {
        // Check for achievements in this scene
        const scene = sceneData[sceneId];
        if (scene && scene.achievements) {
          scene.achievements.forEach(achievement => {
            if (!this.gameState.unlockedAchievements.includes(achievement)) {
              this.gameState.unlockedAchievements.push(achievement);
              this.showAchievementNotification(achievement);
            }
          });
        }
        
        // Update game state
        this.gameState.currentScene = sceneId;
        this.gameState.visitedScenes.push(sceneId);
        
        // Save to localStorage
        this.saveToStorage();
        
        // Scroll to top when changing scenes
        window.scrollTo(0, 0);
        
        // Re-render UI
        this.render();
      }
      
      handleChoice(choiceId) {
        this.loadScene(choiceId);
      }
      
      goBack() {
        if (this.gameState.visitedScenes.length > 1) {
          // Remove current scene
          this.gameState.visitedScenes.pop();
          
          // Get previous scene
          const previousScene = this.gameState.visitedScenes[this.gameState.visitedScenes.length - 1];
          
          // Set current scene to previous scene
          this.gameState.currentScene = previousScene;
          
          // Save and render
          this.saveToStorage();
          this.render();
        }
      }
      
      restartGame() {
        if (confirm('Are you sure you want to restart? Your progress will be lost.')) {
          this.gameState = {
            currentScene: 'start',
            visitedScenes: [],
            unlockedAchievements: [],
            settings: this.gameState.settings // Keep the current settings
          };
          
          this.saveToStorage();
          this.render();
        }
      }
      
      updateSettings(newSettings) {
        this.gameState.settings = {
          ...this.gameState.settings,
          ...newSettings
        };
        
        this.saveToStorage();
        this.render();
      }
      
      showAchievementNotification(achievement) {
        this.showAchievementPopup = true;
        this.currentAchievement = achievement;
        this.render();
        
        // Hide the popup after 3 seconds
        setTimeout(() => {
          this.showAchievementPopup = false;
          this.render();
        }, 3000);
      }
      
      toggleSettings() {
        this.showSettings = !this.showSettings;
        this.render();
      }
      
      openSaveMenu() {
        this.saveLoadMode = 'save';
        this.selectedSlot = null;
        this.render();
      }
      
      openLoadMenu() {
        this.saveLoadMode = 'load';
        this.selectedSlot = null;
        this.render();
      }
      
      closeSaveLoadMenu() {
        this.saveLoadMode = null;
        this.render();
      }
      
      selectSaveSlot(slotId) {
        this.selectedSlot = slotId;
        this.render();
      }
      
      confirmSaveLoad() {
        if (this.selectedSlot === null) return;
        
        if (this.saveLoadMode === 'save') {
          this.saveGame(this.selectedSlot);
        } else {
          this.loadGame(this.selectedSlot);
        }
        
        this.closeSaveLoadMenu();
      }
      
      saveGame(slotId) {
        const slot = this.saveSlots.find(s => s.id === slotId);
        if (!slot) return;
        
        // Format current date
        const date = new Date().toLocaleString();
        
        // Update the save slot
        this.saveSlots = this.saveSlots.map(s => 
          s.id === slotId 
            ? { 
                ...s, 
                scene: this.gameState.currentScene, 
                date: date, 
                empty: false,
                name: `Save Slot ${slotId}`
              } 
            : s
        );
        
        // Save slots to localStorage
        localStorage.setItem('glitteringGlade_saveSlots', JSON.stringify(this.saveSlots));
        
        return true;
      }
      
      loadGame(slotId) {
        const slot = this.saveSlots.find(s => s.id === slotId);
        if (!slot || slot.empty) return false;
        
        // Load the scene
        this.gameState.currentScene = slot.scene;
        this.gameState.visitedScenes = [slot.scene]; // Simplified, we just store the current scene
        
        this.saveToStorage();
        this.render();
        
        return true;
      }
      
      saveToStorage() {
        localStorage.setItem('glitteringGlade_gameState', JSON.stringify(this.gameState));
      }
      
      loadFromStorage() {
        // Load game state
        const savedState = localStorage.getItem('glitteringGlade_gameState');
        if (savedState) {
          this.gameState = JSON.parse(savedState);
        }
        
        // Load save slots
        const savedSlots = localStorage.getItem('glitteringGlade_saveSlots');
        if (savedSlots) {
          this.saveSlots = JSON.parse(savedSlots);
        }
      }
      
      showHelp() {
        alert('How to Play:\n\n1. Read the story text\n2. Click on a choice to proceed\n3. Use the Back button to return to previous scenes\n4. Unlock achievements by exploring different paths\n\nSave your game anytime with the Save button.');
      }
      
      render() {
        const app = document.getElementById('app');
        if (!app) return;
        
        // Get current scene
        const scene = sceneData[this.gameState.currentScene] || {
          title: 'Error',
          content: ['Sorry, that scene could not be found.'],
          choices: [{ id: 'start', text: 'Return to start', icon: 'home' }]
        };
        
        // Set font size based on settings
        document.body.classList.remove('text-sm', 'text-base', 'text-lg');
        if (this.gameState.settings.fontSize === 'small') {
          document.body.classList.add('text-sm');
        } else if (this.gameState.settings.fontSize === 'large') {
          document.body.classList.add('text-lg');
        } else {
          document.body.classList.add('text-base'); // Default medium size
        }
        
        // Main UI
        app.innerHTML = `
          <div id="game-wrapper" class="flex flex-col min-h-screen p-4 md:p-8 overflow-hidden font-story">
            <!-- Game Header -->
            <header class="mb-6 text-center">
              <h1 class="text-3xl md:text-4xl font-bold mb-2 text-[#5bc0be] font-ui">
                Glittering Glade II: The Dreaming Deep
              </h1>
              <div class="game-controls">
                <button class="control-button" id="settingsBtn">
                  <i class="fas fa-cog"></i> <span class="hidden sm:inline">Settings</span>
                </button>
                <button class="control-button" id="saveBtn">
                  <i class="fas fa-save"></i> <span class="hidden sm:inline">Save</span>
                </button>
                <button class="control-button" id="loadBtn">
                  <i class="fas fa-folder-open"></i> <span class="hidden sm:inline">Load</span>
                </button>
                <button class="control-button" id="helpBtn">
                  <i class="fas fa-question-circle"></i> <span class="hidden sm:inline">Help</span>
                </button>
              </div>
              
              <!-- Progress indicator -->
              <div class="progress-indicator">
                ${[...Array(4)].map((_, i) => `
                  <div class="progress-dot ${
                    i < Math.min(this.gameState.visitedScenes.length, 4) ? 'progress-dot-active' : 'progress-dot-inactive'
                  }"></div>
                `).join('')}
              </div>
            </header>
  
            <!-- Main Game Container -->
            <main>
              <div class="story">
                <!-- Story Scene -->
                <div class="animate-fade-in ${scene.isEnding ? 'ending-scene' : ''}">
                  <h2 class="story-title font-ui">${scene.title}</h2>
                  ${scene.content.map((paragraph, index) => `
                    <p class="story-content ${
                      index === scene.content.length - 1 && !scene.isEnding ? 'font-bold' : ''
                    }">${paragraph}</p>
                  `).join('')}
                </div>
  
                <!-- Choice List -->
                ${scene.choices && scene.choices.length > 0 ? `
                  <div class="choices">
                    ${scene.choices.map(choice => `
                      <div class="choice choice-spotlight" data-choice="${choice.id}">
                        <span>
                          <i class="fas fa-${choice.icon || 'arrow-right'} mr-2"></i>
                          ${choice.text}
                        </span>
                      </div>
                    `).join('')}
                  </div>
                ` : ''}
                
                <!-- Easter egg message -->
                ${this.showEasterEgg ? `
                  <div class="mt-6 p-4 bg-[#1e3a5f] rounded-lg text-[#ffdd57] italic animate-pulse-slow">
                    You've been gone 15 minutes...did you fall asleep too?
                  </div>
                ` : ''}
                
                <!-- Story navigation -->
                <div class="nav-buttons">
                  <button id="backBtn" class="btn ${
                    this.gameState.visitedScenes.length <= 1 ? 'hidden' : ''
                  }">
                    <i class="fas fa-arrow-left mr-2"></i> Back
                  </button>
                  <button id="restartBtn" class="btn">
                    <i class="fas fa-redo mr-2"></i> Restart
                  </button>
                </div>
              </div>
            </main>
  
            <!-- Achievements Section -->
            <div class="achievements">
              <div class="achievements-container">
                <h3 class="achievements-title font-ui">
                  <i class="fas fa-trophy mr-2 text-[#ffdd57]"></i> Achievements Unlocked
                </h3>
                <div class="achievements-list">
                  ${this.gameState.unlockedAchievements.map(achievement => `
                    <div class="achievement" title="${achievementDefinitions[achievement] || ''}">
                      <i class="fas fa-star mr-2 text-[#ffdd57]"></i>
                      <span>${achievement}</span>
                    </div>
                  `).join('')}
                  
                  <!-- Add placeholder locked achievements -->
                  ${[...Array(Math.max(0, 6 - this.gameState.unlockedAchievements.length))].map((_, index) => `
                    <div class="achievement achievement-locked">
                      <i class="fas fa-lock mr-2"></i>
                      <span>??? (Undiscovered)</span>
                    </div>
                  `).join('')}
                </div>
              </div>
            </div>
            
            <!-- Footer -->
            <footer class="mt-8 text-center text-[#3a506b] text-sm">
              <p>Glittering Glade II: The Dreaming Deep &copy; 2023</p>
              <p class="mt-1">Created with <i class="fas fa-heart text-[#5bc0be]"></i> by Melancholy Stork Studios</p>
            </footer>
          </div>
  
          <!-- Achievement Popup -->
          ${this.showAchievementPopup ? `
            <div class="achievement-popup">
              <div class="achievement-popup-content">
                <div class="achievement-popup-icon">
                  <i class="fas fa-trophy text-2xl"></i>
                </div>
                <div class="achievement-popup-text">
                  <h4 class="font-bold font-ui">Achievement Unlocked!</h4>
                  <p>${this.currentAchievement}</p>
                </div>
              </div>
            </div>
          ` : ''}
  
          <!-- Settings Modal -->
          ${this.showSettings ? `
            <div class="modal-overlay" id="settingsOverlay">
              <div class="modal">
                <h2 class="modal-title font-ui">
                  <i class="fas fa-cog mr-2"></i> Settings
                </h2>
                <div class="modal-content">
                  <div class="settings-group">
                    <label class="settings-label font-ui">Text Speed</label>
                    <input 
                      type="range" 
                      min="1" 
                      max="10" 
                      value="${this.gameState.settings.textSpeed}" 
                      id="textSpeedRange"
                      class="w-full"
                    />
                  </div>
                  <div class="settings-group">
                    <label class="settings-label font-ui">Font Size</label>
                    <div class="settings-buttons">
                      <button 
                        class="btn"
                        id="smallFontBtn"
                      >
                        A-
                      </button>
                      <button 
                        class="btn"
                        id="largeFontBtn"
                      >
                        A+
                      </button>
                    </div>
                  </div>
                  <div class="settings-group">
                    <label class="settings-label font-ui">Sound Effects</label>
                    <label class="settings-checkbox">
                      <input 
                        type="checkbox" 
                        ${this.gameState.settings.soundEffects ? 'checked' : ''}
                        id="soundEffectsCheck"
                      />
                      <span>Enabled</span>
                    </label>
                  </div>
                  <div class="settings-group">
                    <label class="settings-label font-ui">Background Music</label>
                    <label class="settings-checkbox">
                      <input 
                        type="checkbox" 
                        ${this.gameState.settings.backgroundMusic ? 'checked' : ''}
                        id="bgMusicCheck"
                      />
                      <span>Enabled</span>
                    </label>
                  </div>
                </div>
                <div class="modal-footer">
                  <button 
                    id="closeSettingsBtn"
                    class="btn"
                    style="background-color: #5bc0be;"
                  >
                    Close
                  </button>
                </div>
              </div>
            </div>
          ` : ''}
  
          <!-- Save/Load Modal -->
          ${this.saveLoadMode ? `
            <div class="modal-overlay" id="saveLoadOverlay">
              <div class="modal">
                <h2 class="modal-title font-ui">
                  <i class="fas fa-${this.saveLoadMode === 'save' ? 'save' : 'folder-open'} mr-2"></i> 
                  ${this.saveLoadMode === 'save' ? 'Save Game' : 'Load Game'}
                </h2>
                <div class="modal-content">
                  <div class="save-slots">
                    ${this.saveSlots.map(slot => `
                      <div 
                        class="save-slot ${this.selectedSlot === slot.id ? 'save-slot-selected' : ''}"
                        data-slot="${slot.id}"
                      >
                        <div class="save-slot-info">
                          <div class="save-slot-name">${slot.name}</div>
                          ${slot.empty ? `
                            <div class="save-slot-empty">Empty</div>
                          ` : `
                            <div class="save-slot-scene">
                              ${this.saveLoadMode === 'save' 
                                ? (sceneData[this.gameState.currentScene]?.title || this.gameState.currentScene)
                                : (sceneData[slot.scene]?.title || slot.scene)}
                            </div>
                            <div class="save-slot-date">
                              ${this.saveLoadMode === 'save' ? new Date().toLocaleString() : slot.date}
                            </div>
                          `}
                        </div>
                        <button 
                          class="save-slot-button"
                          data-select-slot="${slot.id}"
                        >
                          Select
                        </button>
                      </div>
                    `).join('')}
                  </div>
                </div>
                <div class="modal-footer">
                  <button 
                    id="cancelSaveLoadBtn"
                    class="btn"
                  >
                    Cancel
                  </button>
                  <button 
                    id="confirmSaveLoadBtn"
                    class="btn"
                    style="background-color: #5bc0be;"
                    ${this.selectedSlot === null ? 'disabled' : ''}
                  >
                    Confirm
                  </button>
                </div>
              </div>
            </div>
          ` : ''}
        `;
        
        // Add event listeners
        this.addEventListeners();
      }
      
      addEventListeners() {
        // Main controls
        document.getElementById('settingsBtn')?.addEventListener('click', () => this.toggleSettings());
        document.getElementById('saveBtn')?.addEventListener('click', () => this.openSaveMenu());
        document.getElementById('loadBtn')?.addEventListener('click', () => this.openLoadMenu());
        document.getElementById('helpBtn')?.addEventListener('click', () => this.showHelp());
        document.getElementById('backBtn')?.addEventListener('click', () => this.goBack());
        document.getElementById('restartBtn')?.addEventListener('click', () => this.restartGame());
        
        // Choices
        document.querySelectorAll('.choice').forEach(choice => {
          choice.addEventListener('click', () => {
            const choiceId = choice.getAttribute('data-choice');
            if (choiceId) this.handleChoice(choiceId);
          });
        });
        
        // Settings modal
        document.getElementById('closeSettingsBtn')?.addEventListener('click', () => this.toggleSettings());
        document.getElementById('settingsOverlay')?.addEventListener('click', (e) => {
          if (e.target.id === 'settingsOverlay') this.toggleSettings();
        });
        document.getElementById('textSpeedRange')?.addEventListener('change', (e) => {
          this.updateSettings({ textSpeed: parseInt(e.target.value) });
        });
        document.getElementById('smallFontBtn')?.addEventListener('click', () => {
          this.updateSettings({ fontSize: 'small' });
        });
        document.getElementById('largeFontBtn')?.addEventListener('click', () => {
          this.updateSettings({ fontSize: 'large' });
        });
        document.getElementById('soundEffectsCheck')?.addEventListener('change', (e) => {
          this.updateSettings({ soundEffects: e.target.checked });
        });
        document.getElementById('bgMusicCheck')?.addEventListener('change', (e) => {
          this.updateSettings({ backgroundMusic: e.target.checked });
        });
        
        // Save/Load modal
        document.getElementById('cancelSaveLoadBtn')?.addEventListener('click', () => this.closeSaveLoadMenu());
        document.getElementById('confirmSaveLoadBtn')?.addEventListener('click', () => this.confirmSaveLoad());
        document.getElementById('saveLoadOverlay')?.addEventListener('click', (e) => {
          if (e.target.id === 'saveLoadOverlay') this.closeSaveLoadMenu();
        });
        
        // Save slots
        document.querySelectorAll('[data-slot]').forEach(slot => {
          slot.addEventListener('click', () => {
            const slotId = parseInt(slot.getAttribute('data-slot'));
            if (!isNaN(slotId)) this.selectSaveSlot(slotId);
          });
        });
        
        document.querySelectorAll('[data-select-slot]').forEach(button => {
          button.addEventListener('click', (e) => {
            e.stopPropagation(); // Prevent triggering the slot's click event
            const slotId = parseInt(button.getAttribute('data-select-slot'));
            if (!isNaN(slotId)) this.selectSaveSlot(slotId);
          });
        });
      }
    }
    
    // Initialize the game when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', () => {
      const game = new GameStateManager();
    });
  </script>
</body>
</html>
